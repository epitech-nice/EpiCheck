apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
    name: epicheck-network-policy
    namespace: epicheck
spec:
    podSelector:
        matchLabels:
            app: epicheck
    policyTypes:
        - Ingress
        - Egress
    ingress:
        # Allow ingress from ingress controller
        - from:
              - namespaceSelector:
                    matchLabels:
                        name: ingress-nginx
          ports:
              - protocol: TCP
                port: 80
        # Allow communication between app and proxy
        - from:
              - podSelector:
                    matchLabels:
                        app: epicheck
          ports:
              - protocol: TCP
                port: 80
              - protocol: TCP
                port: 3001
    egress:
        # Allow DNS
        - to:
              - namespaceSelector:
                    matchLabels:
                        name: kube-system
          ports:
              - protocol: UDP
                port: 53
        # Allow external API calls (Epitech intra, Office 365, etc.)
        - to:
              - podSelector: {}
          ports:
              - protocol: TCP
                port: 443
              - protocol: TCP
                port: 80
        # Allow communication between pods
        - to:
              - podSelector:
                    matchLabels:
                        app: epicheck
